Remove redundant calculations and unneeded array allocations.
